<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Market Intelligence Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 20px;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
}

.tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

.tab {
    padding: 10px 20px;
    cursor: pointer;
    background: #1f2933;
    margin: 0 5px;
    border-radius: 8px;
}

.tab.active {
    background: #2563eb;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.card {
    background: #111827;
    border-radius: 12px;
    padding: 20px;
}

.card h2 {
    font-size: 18px;
    border-bottom: 1px solid #374151;
    padding-bottom: 8px;
}

.row {
    display: flex;
    justify-content: space-between;
    margin: 10px 0;
}

.label { color: #9ca3af; }
.value { font-weight: bold; }

.bullish { color: #22c55e; }
.bearish { color: #ef4444; }
.neutral { color: #facc15; }

.strong { text-shadow: 0 0 8px currentColor; }

.confidence-bar {
    width: 100%;
    height: 10px;
    background: #374151;
    border-radius: 6px;
    overflow: hidden;
}

#confidenceFill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #22c55e, #16a34a);
    transition: width 0.5s ease;
}

.footer {
    text-align: center;
    margin-top: 20px;
    font-size: 13px;
    color: #9ca3af;
}
</style>
</head>

<body>

<h1>ðŸ“Š Market Intelligence Dashboard</h1>

<div class="tabs">
    <div class="tab active" onclick="switchTab('indicators')">Indicators</div>
    <div class="tab" onclick="switchTab('bias')">Market Bias</div>
</div>

<!-- INDICATORS TAB -->
<div id="indicators" class="tab-content active">
    <div class="dashboard">

        <div class="card">
            <h2>VIX</h2>
            <div class="row"><span class="label">Value</span><span id="vix" class="value">--</span></div>
            <div class="row"><span class="label">Sentiment</span><span id="vixSentiment" class="value">--</span></div>
        </div>

        <div class="card">
            <h2>PCR</h2>
            <div class="row"><span class="label">PCR</span><span id="pcr" class="value">--</span></div>
            <div class="row"><span class="label">Sentiment</span><span id="pcrSentiment" class="value">--</span></div>
        </div>

        <div class="card">
            <h2>RSI</h2>
            <div class="row"><span class="label">RSI 15m</span><span id="rsi15" class="value">--</span></div>
            <div class="row"><span class="label">RSI 1Hr</span><span id="rsi60" class="value">--</span></div>
        </div>

        <div class="card">
            <h2>MMI</h2>
            <div class="row"><span class="label">Zone</span><span id="mmiZone" class="value">--</span></div>
        </div>

    </div>
</div>

<!-- MARKET BIAS TAB -->
<div id="bias" class="tab-content">
    <div class="dashboard">

        <div class="card">
            <h2>Market Bias</h2>
            <div class="row"><span class="label">Bias</span><span id="marketBias" class="value strong">--</span></div>
            <div class="row"><span class="label">Action</span><span id="marketAction" class="value strong">--</span></div>

            <div class="row"><span class="label">Confidence</span></div>
            <div class="confidence-bar"><div id="confidenceFill"></div></div>
            <div id="confidenceText" class="value">--</div>
        </div>

        <div class="card">
            <h2>Options Guidance</h2>
            <div class="row"><span class="label">Suggested Play</span><span id="strikeSuggestion" class="value">--</span></div>
            <div class="row"><span class="label">VIX</span><span id="marketVix" class="value">--</span></div>
            <div class="row"><span class="label">Expiry Alert</span><span id="expiryWarning" class="value bearish">--</span></div>
        </div>

        <div class="card">
            <h2>Inputs Snapshot</h2>
            <div class="row"><span class="label">MMI</span><span id="mbMmi" class="value">--</span></div>
            <div class="row"><span class="label">PCR</span><span id="mbPcr" class="value">--</span></div>
            <div class="row"><span class="label">RSI 15m</span><span id="mbRsi15" class="value">--</span></div>
            <div class="row"><span class="label">RSI 1Hr</span><span id="mbRsi60" class="value">--</span></div>
        </div>

    </div>
</div>

<div class="footer">Auto refresh every 5 minutes</div>

<script>
function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelector(`.tab[onclick*="${tab}"]`).classList.add('active');
    document.getElementById(tab).classList.add('active');
}

function cls(t) {
    if (!t) return "neutral";
    t = t.toLowerCase();
    if (t.includes("bull") || t.includes("buy")) return "bullish";
    if (t.includes("bear") || t.includes("sell")) return "bearish";
    return "neutral";
}

async function refreshAll() {
    try {
        const [vix,pcr,rsi,mmi,bias] = await Promise.all([
            fetch("/api/vix").then(r=>r.json()),
            fetch("/api/pcr").then(r=>r.json()),
            fetch("/api/rsi").then(r=>r.json()),
            fetch("/api/mmi").then(r=>r.json()),
            fetch("/api/marketbias").then(r=>r.json())
        ]);

        document.getElementById("vix").innerText = vix.vix?.toFixed(2);
        document.getElementById("vixSentiment").innerText = vix.sentiment;
        document.getElementById("vixSentiment").className = `value ${cls(vix.sentiment)}`;

        document.getElementById("pcr").innerText = pcr.pcr?.toFixed(2);
        document.getElementById("pcrSentiment").innerText = pcr.sentiment;
        document.getElementById("pcrSentiment").className = `value ${cls(pcr.sentiment)}`;

        document.getElementById("rsi15").innerText = rsi.rsi15min?.toFixed(2);
        document.getElementById("rsi60").innerText = rsi.rsi1hr?.toFixed(2);

        document.getElementById("mmiZone").innerText = mmi.zone;
        document.getElementById("mmiZone").className = `value ${cls(mmi.zone)}`;

        document.getElementById("marketBias").innerText = bias.bias;
        document.getElementById("marketAction").innerText = bias.action;
        document.getElementById("marketBias").className = `value strong ${cls(bias.bias)}`;
        document.getElementById("marketAction").className = `value strong ${cls(bias.bias)}`;

        document.getElementById("confidenceFill").style.width = `${Math.min(bias.score,100)}%`;
        document.getElementById("confidenceText").innerText =
            bias.score >= 80 ? "Very Strong" :
            bias.score >= 60 ? "Strong" :
            bias.score >= 40 ? "Moderate" : "Weak";

        document.getElementById("strikeSuggestion").innerText = bias.strike_suggestion || "--";
        document.getElementById("expiryWarning").innerText = bias.expiry_warning || "No Expiry Risk";
        document.getElementById("marketVix").innerText = bias.vix?.toFixed(2);

        document.getElementById("mbMmi").innerText = bias.inputs.mmi_zone;
        document.getElementById("mbPcr").innerText = bias.inputs.pcr?.toFixed(2);
        document.getElementById("mbRsi15").innerText = bias.inputs.rsi15?.toFixed(2);
        document.getElementById("mbRsi60").innerText = bias.inputs.rsi60?.toFixed(2);

    } catch(e) {
        console.error("Refresh failed", e);
    }
}

refreshAll();
setInterval(refreshAll, 300000);
</script>

</body>
</html>

