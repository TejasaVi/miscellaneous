<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Market Signals Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .card {
            background: #111827;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .card h2 {
            margin-top: 0;
            font-size: 18px;
            border-bottom: 1px solid #374151;
            padding-bottom: 8px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }

        .label {
            color: #9ca3af;
        }

        .value {
            font-weight: bold;
        }

        .bullish { color: #22c55e; }
        .bearish { color: #ef4444; }
        .neutral { color: #facc15; }

        .strong {
            text-shadow: 0 0 8px currentColor;
        }

        .footer {
            text-align: center;
            margin-top: 25px;
            font-size: 13px;
            color: #9ca3af;
        }
    </style>
</head>
<body>

<h1>ðŸ“Š Market Signals Dashboard</h1>

<div class="dashboard">

    <!-- INDICES -->
    <div class="card">
        <h2>Index Spot Values</h2>
        <div class="row"><span class="label">NIFTY 50</span><span id="nifty50" class="value">--</span></div>
        <div class="row"><span class="label">BANK NIFTY</span><span id="banknifty" class="value">--</span></div>
        <div class="row"><span class="label">SENSEX</span><span id="sensex" class="value">--</span></div>
        <div class="row"><span class="label">Last Update</span><span id="indicesTime" class="value">--</span></div>
    </div>

    <!-- VIX -->
    <div class="card">
        <h2>VIX</h2>
        <div class="row"><span class="label">Value</span><span id="vix" class="value">--</span></div>
        <div class="row"><span class="label">Sentiment</span><span id="vixSentiment" class="value">--</span></div>
        <div class="row"><span class="label">Action</span><span id="vixAction" class="value">--</span></div>
    </div>

    <!-- PCR -->
    <div class="card">
        <h2>PCR</h2>
        <div class="row"><span class="label">PCR</span><span id="pcr" class="value">--</span></div>
        <div class="row"><span class="label">Sentiment</span><span id="pcrSentiment" class="value">--</span></div>
        <div class="row"><span class="label">Action</span><span id="pcrAction" class="value">--</span></div>
    </div>

    <!-- RSI -->
    <div class="card">
        <h2>RSI</h2>
        <div class="row"><span class="label">RSI (15m)</span><span id="rsi15" class="value">--</span></div>
        <div class="row"><span class="label">RSI (1Hr)</span><span id="rsi60" class="value">--</span></div>
        <div class="row"><span class="label">Sentiment</span><span id="rsiSentiment" class="value">--</span></div>
    </div>

    <!-- NEW API -->
    <div class="card">
        <h2>Market Zone</h2>
        <div class="row"><span class="label">Value</span><span id="zoneValue" class="value">--</span></div>
        <div class="row"><span class="label">Zone</span><span id="zoneLabel" class="value">--</span></div>
    </div>

</div>

<div class="footer">
    Auto-refresh every 5 minutes
</div>

<script>
    function sentimentClass(sentiment) {
        if (!sentiment) return "";
        const s = sentiment.toLowerCase();
        if (s.includes("buy")) return "bullish";
        if (s.includes("sell")) return "bearish";
        return "neutral";
    }

    function applySentiment(el, sentiment) {
        el.innerText = sentiment || "--";
        el.className = `value ${sentimentClass(sentiment)}`;
        if (sentiment && sentiment.toLowerCase().includes("strong")) {
            el.classList.add("strong");
        }
    }

    async function fetchIndices() {
        const res = await fetch("/api/indices");
        const d = await res.json();
        document.getElementById("nifty50").innerText = d.NIFTY50?.toFixed(2) ?? "--";
        document.getElementById("banknifty").innerText = d.BANKNIFTY?.toFixed(2) ?? "--";
        document.getElementById("sensex").innerText = d.SENSEX?.toFixed(2) ?? "--";
        document.getElementById("indicesTime").innerText = d.timestamp ?? "--";
    }

    async function fetchVIX() {
        const d = await (await fetch("/api/vix")).json();
        document.getElementById("vix").innerText = d.vix?.toFixed(2) ?? "--";
        document.getElementById("vixAction").innerText = d.action ?? "--";
        applySentiment(document.getElementById("vixSentiment"), d.sentiment);
    }

    async function fetchPCR() {
        const d = await (await fetch("/api/pcr")).json();
        document.getElementById("pcr").innerText = d.pcr?.toFixed(2) ?? "--";
        document.getElementById("pcrAction").innerText = d.action ?? "--";
        applySentiment(document.getElementById("pcrSentiment"), d.sentiment);
    }

    async function fetchRSI() {
        const d = await (await fetch("/api/rsi")).json();
        document.getElementById("rsi15").innerText = d.rsi15min?.toFixed(2) ?? "--";
        document.getElementById("rsi60").innerText = d.rsi1hr?.toFixed(2) ?? "--";
        applySentiment(document.getElementById("rsiSentiment"), d.sentiment);
    }

    async function fetchMMI() {
        const d = await (await fetch("/api/mmi")).json();
        document.getElementById("zoneValue").innerText = d.value?.toFixed(2) ?? "--";

        const z = document.getElementById("zoneLabel");
        z.innerText = d.zone ?? "--";
        z.className = `value ${sentimentClass(d.zone)}`;
    }

    async function refreshDashboard() {
        try {
            await Promise.all([
                fetchIndices(),
                fetchVIX(),
                fetchPCR(),
                fetchRSI(),
                fetchMMI()
            ]);
            console.log("Dashboard refreshed", new Date().toLocaleTimeString());
        } catch (e) {
            console.error("Dashboard refresh failed", e);
        }
    }

    refreshDashboard();
    setInterval(refreshDashboard, 300000);
</script>

</body>
</html>

